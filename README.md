# HydroCMS
水利设计管理系统
 
HydroCMS水利设计成果管理系统介绍

                  ——QinGo（QQ504284）

目录

目录	1

1 管理员初级篇

1.1 系统安装及设置

1.2 设置需要爬取的电脑IP和端口及名称

1.3 设置爬取的时间段

1.4 用户管理

1.5 个性化

1.6 守护进程；随系统启动服务；数据库及上传附件定期备份；删除过期数据库和上传附件

1.7 静态文件下载服务

1.8 管理or开发工具

2 使用篇

2.1 新建项目

2.2 往成果分类中添加计划目录和成果以及批量打包下载

2.3 写设代日记

2.4 检索成果

2.5 应用的部署（安装）

2.6 应用的一些特性

2.7 应用的一些用途

2.8 电子文件管理初步


 
1 管理员初级篇

1.1 系统安装及设置

系统需求：win7 64位系统以上（Microsoft Windows 7 (6.1) Home Premium Edition 64-bit Service Pack 1 (Build 7601)）

浏览器要用Google Chrome

下载HydroCMS压缩包，解压到D盘下，如D:\quick\quick.exe，运行quick.exe文件，如果闪退，则可能是默认的端口80被占用，此时修改D:\quick\conf\ app.conf

httpport = 80

修改上面的80为8080

重新运行quick.exe

80端口的好处是浏览器默认的端口，不用输。比如访问**.**.**.**:80只要在浏览器输入**.**.**.**即可。

管理员登陆用户名为admin，密码为admin
 
1.2 设置需要爬取的电脑IP和端口及名称

打开D:\quick\conf\testjsonWithArray.conf

[
	{	
		"username": "**",
		"serviceAPI": "http://**.**.**.**3",
		"port": "80"
	},
	{	
		"username": "qingo",
		"serviceAPI": "http://**.**.**.**",
		"port": "8080"
	}	
]

注意：大括号之间代表一个主机，2个以上大括号要注意末端的逗号，但最后一个大括号不用逗号。

1.3 设置爬取的时间段

修改D:\quick\conf\ app.conf

程序多长时间执行一次爬虫：每隔？小时执行一次。一天里只能填写每隔6、4、3、2、1

spec = 1

1.4 用户管理
批量用户上传http://***/user/index
 
Excel用户格式

每列分别对应：用户名，密码，邮箱，昵称，权限等级。

xue.wx	x**	x**@g**e.com	薛	4

zh**m	zh**	zhang.**@g**.com	张**	4


用户管理访问地址：

Ip:端口号：http://***/user/index
 
点击进入一个用户
 
修改权限roletitle为1~4级权限，1级为管理员，2级为项目负责人，3级为设计人员，4级为默认注册人员。

查看权限的页面地址：http://***/role/index
 
1.5 个性化

修改导航栏

D:\quick\views\T.navbar.tpl

    <ul class="nav navbar-nav">
      <li {{if .IsSpider}}class="active"{{end}}>
        <a href="/getspider">水利设计院</a>
      </li>

      <li {{if .IsHome}}class="active"{{end}}>
        <a href="/">
          首页
          <span class="sr-only">(current)</span>
        </a>
      </li>
      <li {{if .IsCategory}}class="active"{{end}}>
        <a href="/category">项目</a>
      </li></ul>

1.6 守护进程；随系统启动服务；数据库及上传附件定期备份；删除过期数据库和上传附件
数据库：D:\quick\database\orm_test.db

上传的附件在D:\quick\attachment

1.7 静态文件下载服务

把文件放到static根目录或子目录中

D:\quick\static\

在view\目录下的help.html中修改链接：

HydroCMS系统整体打包下载；

当然，可以建立项目和目录，上传附件。

1.8 管理or开发工具

1）Sublime Text 3代码编辑器——打开*.tpl或*.html文件，注释掉代码的快捷键是Ctrl+/

2）SQLite Expert version 3.5查看数据库

3）BCompare.exe文件对比

4）FileLocatorPro.exe文件全文搜索

5）Fiddler4记录路由传参

2 使用篇

2.1 新建项目
 
填写项目名称和编号（档案号）——选择树状目录：工程阶段—专业配备—成果类型
 
项目生成
 
进行项目目录查看
 
同时，在服务器硬盘生成树状目录
 
2.2 往成果分类中添加计划目录和成果以及批量打包下载

添加计划目录
 
Excel目录样式

	成果编号DWG NO	成果名称	DRAWN	DESIGNED 	CHECKED 	EMAMINED 	VERIFIED  	APPROVED	DATE	DESIGN STAGE	SECTION	PROJECT
1	SL888-500-001	下部结构	张光斗	潘家铮	施耐庵	柴静	吴小莉	秋菊	2010.01	可研	水工	航空航天
2	SL888-500-002	上部结构	张光斗	潘家铮	施耐庵	柴静	吴小莉	秋菊	2011.01	可研	水工	航空航天
3	SL888-500-003	连接件	张光斗	潘家铮	施耐庵	柴静	吴小莉	秋菊	2012.01	可研	水工	航空航天
4	SL888-500-004	飞行结构	张光斗	潘家铮	施耐庵	柴静	吴小莉	秋菊	2013.01	可研	水工	航空航天
5	SL888-500-005	空天接口	张光斗	潘家铮	施耐庵	柴静	吴小莉	秋菊	2014.01	可研	水工	航空航天

添加成果

选择添加模式：一对一模式指批量选择的文件，每个文件在这个分类下需要拥有唯一的文件号和文件名，比如一般的图纸“SL888FT-500-88取水泵站厂房结构图.DWG”；一对多模式指一个编号下有多个附件，比如一本报告SL888BT-100-01可研报告，有几个独立的word章节，或者一个泵站的全套图纸，或者一张图中有参照光栅图等情况。后面的设代日记也是这种情况，一个主题下很多张照片。
 
一对一模式下自动截取前面的编号和文件名，所以只要批量选择文件即可。
  
选择2个文件即生成2个成果：点击进行查看、下载等。
 
点击进行查看：
 
Pdf格式浏览器直接阅览：
 
2.3 写设代日记

写设代日记分为2步进行，第一步批量上传照片，第二步往每张照片中写入说明文字。

第一步：进入日记类
 
点击写设代日记
 
一定要填写日记编号，并且保证这个编号在这个分类下是唯一的，否则无法存入数据库。可以用日期，一天有多个，可往后加数字-1，-2……
先批量选择照片——上传
 
第二步：上传完成后再向每个照片中添加文字说明——完成后提交。
 
2.4 检索成果

在导航栏的搜索框中输入需要查询的关键字，提交即可。目前只支持成果名称的字段检索。
 
可得到查询结果
 
2.5 应用的部署（安装）

把文件夹放到某个目录下（仅箭头指示的有用，其他只是源代码而已，已经编译到exe中），运行exe文件即可在浏览器中输入机器ip:8080即可。
可以将整个目录拷贝，放到任何电脑上执行即可进行成果管理。
局域网内外需通过VPN进行连接。www.***.com上有vpn的入口，用户名和密码是自己电脑登陆***域的登陆名和密码。
 
2.6 应用的一些特性

1、该应用基本特性：数据库为sqlite3.8.8.1（无服务型）；采用beego1.4.3开源框架（golang1.4.1开源语言）；前端框架使用了Bootstrap；前端表格排序使用jquery.tablesorter；前端编辑器使用editormd；批量上传使用了Uploadify v3.2.1插件；代码编辑器用的是Sublime Text 3。
2、展望：后续增加用户按项目分组管理；重构项目——阶段——专业——分类路由及导航条；爬虫对于主机的活动与否进行点亮与灭及对爬取结果进行实效性检查；加入计划及完成计划页面；修改页面跳转的bug：登陆、添加成果等；并发来运行spider；支持用户自定义定时备份数据库和上传附件及删除过期文件；

2.7 应用的一些用途

1、改变专业负责人的工作方式，减少协调工作。
 
2、工程师个人资料整理、总结、发布
 
3、培训、经验交流
 
4、统计、业绩展示
 
2.8 电子文件管理初步

1、电子文件命名

http://***/topic/view_b/224

2、关于目录的整理、文件名的编号+名称批量修改、批量提取CAD图纸里的信息

关于目录：一般都会有个计划目录，或者只有电子文件，而没有目录；——后者用HyperSnap的文字提取功能，做成一个只有编号的目录。再开发一个工具，根据图号，批量提取图纸名称及其他信息。

电子文件：一种是用图号命名的，如SL888FT-502-01.dwg；——这种结合批量命名工具可以根据目录批量命名成图号+图名的样子。

一种是用图名命名的，如邦山泵站厂房结构布置图.dwg；——这种也要开发个批量命名工具根据目录来批量修改成图号+图名的样子。

3、有了图号+图名的电子图，可以批量上传到CMS系统，自动截取图号和图名。在CMS系统上，再导出目录——再批量提取图纸信息。

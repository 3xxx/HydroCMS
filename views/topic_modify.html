<!DOCTYPE html>
{{template "header"}}
<title>修改成果 - 水利设计CMS系统</title>
<style type="text/css">
h3 {line-height: 150%;
  /*color: #DC143C;#000000*/
  color:#FFFFFF;
  background: #4682B4;/*#fff*/
  margin: 10;
  padding: 10;
  font-family: Georgia, Palatino, serif;
  }
</style>
</head>

<script src="/static/js/jquery-2.1.3.js" type="text/javascript" charset="utf-8"></script>
<script src="/static/js/uploadify/jquery.uploadify.min.js" type="text/javascript"></script>
<link rel="stylesheet" href="/static/js/uploadify/uploadify.css" type="text/css">

<body>
<div class="navbar navba-default navbar-fixed-top">
  <div class="container-fill">{{template "navbar" .}}</div>
</div>

<div class="col-lg-12">
  <!-- 这里添加项目目录树显示 -->
  <h3> <font size="5" >{{.TopicProj.Title}}</font> <font size="4"> » {{.TopicPhase.Title}}</font>
    <font size="4"> » {{.TopicSpec.Title}}</font>
    <font size="5"> » {{.TopicChengguo.Title}}</font>
  </h3>
  <h2>修改成果</h2>
  <form method="post" action="/topic/post" enctype="multipart/form-data">

    <input type="hidden" name="tid" value="{{.Tid}}">

    <div class="form-group">
      <label>成果编号:</label>
      <input id="name" type="text" class="form-control"  placeholder="Enter account" name="tnumber" value="{{.Topic.Tnumber}}"></div>

    <div class="form-group">
      <label>成果名称:</label>
      <input id="name" type="text" class="form-control"  placeholder="Enter account" name="title" value="{{.Topic.Title}}"></div>

    <div class="form-group">
      <label>成果分类</label>
      <input readonly="readonly" type="text" class="form-control" name="category" value="{{.Topic.Category}}"></div>
    <div class="form-group">
      <label>成果分类ID</label>
      <input readonly="readonly" id="categoryid" type="text" class="form-control"  name="categoryid" value="{{.Topic.CategoryId}}"></div>

    <div class="form-group">
      <label>成果内容:</label>
      <textarea name="content" cols="30" rows="10" class="form-control" placeholder="Enter account" >{{.Topic.Content}}</textarea>
    </div>

    <div class="form-group">

      <h5>
        成果附件：
        <ol>
          {{range .Attachment}}
          <li>
            <a href={{.Route}}>{{.FileName}}</a>
            文件大小：{{.FileSize}}KB
            <a href="/attachment/delete?aid={{.Id}}&tid={{$.Tid}}&op=modify">删除</a>
          </li>
          {{end}}
        </ol>
      </h5>
    </div>

    <div class="control-group">
      <div class="controls">
        <div id="queue"></div>
        <input id="image" name="image" type="file">
        <input type="hidden" name="filesize"  id="filesize"/>
      </div>
    </div>

    <div class="form-actions">
      <button type="button" class="btn btn-primary" onclick="startUpload()">追加附件</button>
      <button type="button" class="btn btn-primary" onclick="$('#fimage').uploadify('stop')">停止上传</button>
    </div>
    <button type="submit" class="btn btn-primary">提交修改</button>
    <!-- class="btn btn-default" --> </form>
</div>
<div id="show"></div>
<script type="text/javascript">
//定义全局变量
 
function startUpload() {
  // var x=document.forms["myForm"]["fname"].value;
  var a = document.getElementsByName("categoryid");
      a=a[0].value;
  var b = document.getElementsByName("category");
      b=b[0].value;
  var c = document.getElementsByTagName("textarea");
      c=c[0].value;  
  var d = document.getElementsByName("tid");
      d=d[0].value; 
  // var e = document.getElementsByName("tnumber");
  //     e=e[0].value;
  // var f = document.getElementsByName("title");
  //     f=f[0].value;
   $('#image').uploadify("settings", 'formData', {'categoryid':a,'category':b,'content':c,'tid':d});  
   $('#image').uploadify('upload','*');
 }

$(function(){             
    $("#image").uploadify({       //绑定元素      
    'fileObjName':'image',//html input标签的name属性的值吧。                 
    'debug':false,                  
    'auto':false,    //自动上传              
    'buttonText':'批量选择文件',                   
    'removeCompleted':false, //上传完成以后是否保存进度条                    
    'cancelImg':'/static/js/uploadify/uploadify-cancel.png',                   
    'swf':'/static/js/uploadify/uploadify.swf', <!--//必须设置  swf文件路径  -->            
    'uploader':'/topic/modifytopic',         //必须设置，上传文件触发的url       
    'overrideEvents':['onDialogClose'],                
    'multi':true,   
    'preventCaching': true,
    'onQueueComplete' : function(queueData) {
             alert('success:'+queueData.uploadsSuccessful+'fail:'+queueData.uploadsErrored);  
            // alert(queueData.uploadsSuccessful +' 个文件上传成功.'); 
            // $("#big").val(queueData.size);这个是错误的
            // window.location.href='/topic'//action?catId="+$('#catId').val();//上传成功后跳转，并传递参数
        }
    });        
}); 
</script>
</body>
</html>